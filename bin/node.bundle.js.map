{"version":3,"sources":["webpack:///webpack/bootstrap 03f8e32ae37b81a7bc71","webpack:///./src/index.js","webpack:///./src/config.js","webpack:///external \"lodash\"","webpack:///./src/storage.js","webpack:///external \"path\"","webpack:///external \"fs\"","webpack:///external \"botpress-version-manager\"","webpack:///external \"eris\"","webpack:///./src/outgoing.js","webpack:///external \"request-promise\"","webpack:///./src/incoming.js","webpack:///./src/actions.js","webpack:///external \"bluebird\""],"names":["checkVersion","require","Eris","outgoing","incoming","actions","Promise","eris","outgoingPending","pending","outgoingMiddleware","event","next","platform","type","module","exports","init","bp","__dirname","middlewares","register","name","order","handler","description","discord","forIn","action","sendName","replace","method","msg","apply","arguments","__id","Date","toISOString","Math","random","resolver","promise","resolve","reject","sendOutgoing","isSelf","id","user","isPrivate","channel","guild","undefined","ready","config","Client","botToken","get","raw","connect","configKeys","configDefaults","useSelf","configStorage","load","createConfigAccessMethods","key","set","value","save","accessMethods","reduce","acc","extraMethods","getAll","setAll","newConfig","forEach","getFilePath","projectLocation","modulesConfigDir","botfile","fileName","join","writeJsonFile","filePath","data","writeFileSync","JSON","stringify","readJsonFile","flow","readFileSync","parse","createSaveFn","createLoadFn","defaultData","existsSync","rp","handlePromise","then","res","catch","err","handleText","channelId","text","embed","createMessage","handleTyping","handleAttachment","filename","uri","pr","str","file","Buffer","from","handleImage","filetype","now","encoding","buff","handleTextUpdate","msgId","editMessage","on","db","saveUser","author","gender","timezone","locale","picture_url","first_name","username","last_name","sendIncoming","content","channelID","status","game","embeds","createText","chId","txt","extra","Object","assign","message","trim","createAttachment","split","pop","createImage","createTextUpdate","createTyping"],"mappings":"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","file":"node.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/Users/japh/Projects/botpress-discord\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 03f8e32ae37b81a7bc71","const checkVersion = require('botpress-version-manager')\n\nconst Eris = require(\"eris\")\nconst outgoing = require(\"./outgoing\")\nconst incoming = require(\"./incoming\")\nconst actions = require(\"./actions\")\nconst Promise = require(\"bluebird\")\nimport createConfig from \"./config\"\nimport _ from \"lodash\"\n\nlet eris = null\nlet outgoingPending = outgoing.pending\n\nconst outgoingMiddleware = (event, next) => {\n  if (event.platform !== \"discord\") {\n    return next()\n  }\n  if(!outgoing[event.type]) {\n    return next(\"Unsupported event type: \" + event.type)\n  }\n\n  outgoing[event.type](event, next, eris)\n\n}\n\nmodule.exports = {\n  init: function(bp) {\n\n    checkVersion(bp, __dirname)\n\n    bp.middlewares.register({\n      name: \"discord.sendMessages\",\n      type: \"outgoing\",\n      order: 100,\n      handler: outgoingMiddleware,\n      module: \"botpress-discord\",\n      description: \"Sends out messages that targets platform = slack.\" +\n      \" This middleware should be placed at the end as it swallows events once sent.\"\n    })\n\n    bp.discord = {}\n    _.forIn(actions, (action,name) => {\n      bp.discord[name] = action\n      var sendName = name.replace(/^create/, \"send\")\n      //console.log(\"Created action \" + sendName)\n      bp.discord[sendName] = Promise.method(function() {\n        var msg = action.apply(this,arguments)\n        msg.__id = new Date().toISOString() + Math.random()\n        const resolver = {event: msg}\n        const promise = new Promise(function(resolve, reject) {\n          resolver.resolve = resolve\n          resolver.reject = reject\n        })\n        outgoingPending[msg.__id] = resolver\n        bp.middlewares.sendOutgoing(msg)\n        return promise\n      })\n    })\n    bp.discord.isSelf = (id) => id === eris.user.id\n    bp.discord.isPrivate = (msg) => msg.channel.guild === undefined\n  },\n  ready: function(bp) {\n    const config = createConfig(bp)\n    eris = new Eris.Client(config.botToken.get())\n    bp.discord.raw = eris\n    eris.connect()\n    incoming(bp, eris, config)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","import _ from \"lodash\"\nimport createStorage from \"./storage\"\n\nexport default bp => {\n  const configKeys = [\n    \"botToken\",\n    \"useSelf\"\n  ]\n\n  const configDefaults = {\n    botToken: null,\n    useSelf: false\n  }\n\n  const configStorage = createStorage(bp, configDefaults)\n\n  const config = configStorage.load()\n\n  const createConfigAccessMethods = key => ({\n    get: () => config[key],\n    set: value => {\n      config[key] = value\n      configStorage.save(config)\n    }\n  })\n\n  const accessMethods = _.reduce(configKeys, (acc, key) => ({\n    ...acc,\n    [key]: createConfigAccessMethods(key)\n  }), {})\n\n  const extraMethods = {\n    getAll: () => config,\n    setAll: (newConfig) => _.forEach(configKeys, key => {\n      accessMethods[key].set(newConfig[key])\n    })\n  }\n\n  return {\n    ...accessMethods,\n    ...extraMethods,\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/config.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 3\n// module chunks = 0","import _ from 'lodash'\nimport path from 'path'\nimport fs from 'fs'\n\nconst getFilePath = (bp, name) => {\n  const {\n    projectLocation,\n    botfile: {\n      modulesConfigDir\n    }\n  } = bp\n\n  const fileName = name\n    ? `botpress-discord-${name}.json`\n    : 'botpress-discord.json'\n\n  return path.join(\n    projectLocation,\n    modulesConfigDir,\n    fileName\n  )\n}\n\nconst writeJsonFile = (filePath, data) =>\n  fs.writeFileSync(filePath, JSON.stringify(data))\n\nconst readJsonFile = _.flow([\n  fs.readFileSync,\n  JSON.parse\n])\n\nconst createSaveFn = filePath => data =>\n  writeJsonFile(filePath, data)\n\nconst createLoadFn = (filePath, defaultData) => () => {\n  if (!fs.existsSync(filePath)) {\n    createSaveFn(filePath)(defaultData)\n    return defaultData\n  }\n\n  return readJsonFile(filePath)\n}\n\nexport default (bp, defaultData, name) => {\n  const filePath = getFilePath(bp, name)\n\n  return {\n    save: createSaveFn(filePath),\n    load: createLoadFn(filePath, defaultData)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/storage.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"botpress-version-manager\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"botpress-version-manager\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"eris\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"eris\"\n// module id = 8\n// module chunks = 0","var rp = require(\"request-promise\")\n\nconst handlePromise = (next,promise) => {\n  return promise.then(res => {\n    next()\n    return res\n  })\n  .catch(err => {\n    next(err)\n    throw err\n  })\n}\n\nconst handleText = (event, next, discord) => {\n  if(event.platform !== \"discord\" || event.type !== \"text\") {\n    return next()\n  }\n\n  const channelId = event.raw.channelId\n  const text = event.text\n  const raw = (typeof event.raw !== \"string\") ? event.raw : {};\n  const embed = event.raw.embed ? event.raw.embed : false;\n\n  return handlePromise(next, discord.createMessage(channelId, {\"content\": text}))\n  //return handlePromise(next, discord.createMessage(channelId, {\"content\": text, \"embed\": embed}))\n}\n\nconst handleTyping = (event, next, discord) => {\n  if(event.platform !== \"discord\" || event.type !== \"typing\") {\n    return next()\n  }\n\n  const channelId = event.raw.channelId\n  const text = event.text\n  const raw = (typeof event.raw !== \"string\") ? event.raw : {};\n\n  return handlePromise(next, discord.createMessage(channelId, {\"content\": text}))\n}\n\nconst handleAttachment = (event, next, discord) => {\n  if(event.platform !== \"discord\" || event.type !== \"attachment\") {\n    return next()\n  }\n\n  const channelId = event.raw.channelId\n  const description = event.text\n  const filename = event.raw.filename\n  const uri = event.raw.uri\n\n var pr = new Promise( (resolve, reject) => {\n   rp(uri)\n    .then( (str) => {\n      resolve(discord.createMessage(channelId, description, {name: filename, file: Buffer.from(str)}))\n    })\n    .catch( err => {\n      reject(err)\n    })\n })\n  return handlePromise(next, pr)\n}\n\nconst handleImage = (event, next, discord) => {\n  if(event.platform !== \"discord\" || event.type !== \"image\") {\n    return next()\n  }\n  const channelId = event.raw.channelId\n  const uri = event.raw.uri\n  const filetype = event.raw.type || \"png\"\n  const filename = Date.now() + \".\" + filetype\n\n  var pr = new Promise( (resolve, reject) => {\n    rp({uri: uri,encoding: null})\n     .then( (buff) => {\n       resolve(discord.createMessage(channelId, \"\", {name: filename, file: Buffer.from(buff)}))\n     })\n     .catch( err => {\n       reject(err)\n     })\n  })\n  return handlePromise(next, pr)\n\n}\n\nconst handleTextUpdate = (event, next, discord) => {\n  if(event.platform !== \"discord\" || event.type !== \"textUpdate\") {\n    return next()\n  }\n\n  const channelId = event.raw.channelId\n  const msgId = event.raw.msgId\n  const text = event.raw.msg\n\n  return handlePromise(next, discord.editMessage(channelId, msgId, text))\n\n}\n\nmodule.exports = {\n  \"text\": handleText,\n  \"typing\": handleTyping,\n  \"attachment\": handleAttachment,\n  \"image\": handleImage,\n  \"textUpdate\": handleTextUpdate,\n  pending: {}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/outgoing.js","module.exports = require(\"request-promise\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"request-promise\"\n// module id = 10\n// module chunks = 0","import outgoing from \"./outgoing\"\n\nmodule.exports = (bp, discord, config) => {\n  discord.on(\"messageCreate\", msg => {\n\n  // This seems more or less required by the botpress framework\n  // It probably shouldn't though !\n    bp.db.saveUser({\n      id: msg.author.id,\n      platform: 'discord',\n      gender: null,\n      timezone: null,\n      locale: null,\n      picture_url: null,\n      first_name: msg.author.username,\n      last_name: null,\n    }).then(() => {\n\n      if(config.useSelf.get() === true) {\n        if(bp.discord.isSelf(msg.author.id)) {\n          bp.middlewares.sendIncoming({\n            platform: \"discord\",\n            type: \"message\",\n            user: msg.author,\n            text: msg.content,\n            channel: msg.channel,\n            raw:  msg\n          })\n        }\n      }else{\n        if(!bp.discord.isSelf(msg.author.id)) {\n          bp.middlewares.sendIncoming({\n            platform: \"discord\",\n            type: \"message\",\n            user: msg.author,\n            text: msg.content,\n            channel: msg.channel,\n            raw:  msg\n          })\n        }\n      }\n\n    });\n\n  })\n\n  discord.on(\"ready\", () => {\n    bp.middlewares.sendIncoming({\n      platform: \"discord\",\n      type: \"ready\",\n      user: \"\",\n      text: \"\",\n      discord: discord,\n      raw: discord\n    })\n  })\n\n  discord.on(\"typingStart\", (event, user) => {\n    bp.middlewares.sendIncoming({\n      platform: \"discord\",\n      type: \"typing\",\n      user: user,\n      channelID: event.id,\n      text: \"\",\n      raw:  {\"event\": event, \"user\": user}\n    })\n  })\n\n  discord.on(\"presenceUpdate\", (event) => {\n    bp.middlewares.sendIncoming({\n      platform: \"discord\",\n      type: \"status\",\n      user: event.user,\n      text: \"\",\n      status: event.status,\n      game: event.game ? event.game : {type: false, name: false},\n      raw:  event\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/incoming.js","const embeds = require(\"./embeds\")\nimport _ from \"lodash\"\n\nconst createText = (chId, txt, extra = {}) => {\n\n  let raw = Object.assign({\n    channelId: chId,\n    message: txt.trim()\n  }, extra);\n\n  return {\n    platform: \"discord\",\n    type: \"text\",\n    text: (typeof txt === \"string\") ? txt : \"\",\n    raw: raw\n  }\n}\n\nconst createAttachment = (chId, description, uri) => {\n  var filename = uri.split('/').pop().split('#')[0].split('?')[0]\n  return {\n    platform: \"discord\",\n    type: \"attachment\",\n    text: description,\n    raw: {\n      filename: filename,\n      uri: uri,\n      channelId: chId\n    }\n  }\n}\n\nconst createImage = (chId, uri, filetype) => {\n  return {\n    platform: \"discord\",\n    type: \"image\",\n    text: \"\",\n    raw: {\n      uri: uri,\n      channelId: chId,\n      type: filetype || \"png\"\n    }\n  }\n}\n\nconst createTextUpdate = (chId, msgId, content) => {\n  return {\n    platform: \"discord\",\n    type: \"textUpdate\",\n    text: \"\",\n    raw: {\n      channelId: chId,\n      msgId: msgId,\n      msg: content\n    }\n  }\n}\n\nconst createTyping = (chId, txt, extra = {}) => {\n\n  let raw = Object.assign({\n    channelId: chId,\n    message: txt.trim()\n  }, extra);\n\n  return {\n    platform: \"discord\",\n    type: \"typing\",\n    text: \"\",\n    raw: raw\n  }\n}\n\nmodule.exports = {\n  createText,\n  createTyping,\n  createAttachment,\n  createImage,\n  createTextUpdate\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/actions.js","module.exports = require(\"bluebird\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bluebird\"\n// module id = 14\n// module chunks = 0"],"sourceRoot":""}